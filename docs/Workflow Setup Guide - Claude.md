# 开源讯飞星辰 Agent 平台工作流搭建指南

## 第一条工作流：课程大纲生成器

---

## 📋 准备工作

### 1. 快速部署

**访问地址：** https://github.com/iflytek/astron-agent/blob/main/README-zh.md

**推荐 Docker Compose 部署方式**
```
# 克隆项目
git clone https://github.com/iflytek/astron-agent.git

# 进入 astronAgent 目录
cd docker/astronAgent

# 复制环境变量配置
cp .env.example .env

# 启动所有服务（包含 Casdoor）
docker compose -f docker-compose-with-auth.yaml up -d

# 查看服务状态
docker compose ps

# 查看服务日志
docker compose logs -f
```

**部署成功后：**
1. 访问 http://localhost/
2. 默认的登录账户名：admin，密码：123
3. 进入"工作流"或"智能体"页面
4. 点击"创建工作流"

---

## 🎯 工作流设计

### 工作流名称
```
CourseOutlineGenerator
```
（课程大纲生成器）

### 工作流描述
```
根据小学课本内容，自动生成结构化的课程大纲，包含学习模块、目标和关键概念。
```

---

## 🔧 工作流搭建步骤

### 步骤1：创建工作流

1. **点击"新建工作流"**
2. **填写基本信息：**
   - 名称：`CourseOutlineGenerator`
   - 描述：`课程大纲生成器`
   - 分类：教育/助手

### 步骤2：配置输入参数

在工作流画布左侧，添加**输入节点**：

**参数配置：**

| 参数名 | 类型 | 是否必填 | 默认值 | 说明 |
|--------|------|----------|--------|------|
| TEXTBOOK_CONTENT | 文本(string) | 是 | 无 | 课本的文本内容 |
| GRADE_LEVEL | 文本(string) | 否 | "三年级" | 年级 |
| SUBJECT | 文本(string) | 否 | "语文" | 学科 |
| MODULE_COUNT | 数字(number) | 否 | 4 | 期望生成的模块数量 |

**在界面上的操作：**
```
1. 拖拽"输入"节点到画布
2. 点击输入节点
3. 在右侧属性面板添加参数：
   - 点击"添加参数"
   - 填写参数名称
   - 选择参数类型
   - 设置是否必填
   - 填写说明文字
```

---

### 步骤3：添加大模型节点（核心）

**节点名称：** `课程大纲生成`

#### 3.1 基础配置

**模型选择：**
- 选择：**讯飞星火 Spark X1-32K** （可在星辰 MaaS 平台领取额度）
- Temperature（温度）：`0.7`（创造性适中）
- Max Tokens（最大输出）：`2000`（确保能输出完整大纲）

#### 3.2 System Prompt（系统提示词）

```
你是一位资深的小学教育专家和课程设计师，擅长分析课本内容并设计结构化的教学大纲。

你的任务是：
1. 仔细分析提供的课本内容
2. 提取关键的教学要点
3. 设计合理的课程模块划分
4. 为每个模块设定清晰的学习目标
5. 输出结构化的 JSON 格式大纲

要求：
- 适合小学生的认知水平
- 学习目标要具体、可衡量
- 模块之间要有逻辑递进关系
- 严格按照指定的 JSON 格式输出
```

#### 3.3 User Prompt（用户提示词）

```
请分析以下小学课本内容，生成一个完整的课程大纲。

【课本信息】
年级：{GRADE_LEVEL}
学科：{SUBJECT}
期望模块数：{MODULE_COUNT}

【课本内容】
{TEXTBOOK_CONTENT}

【输出要求】
请严格按照以下 JSON 格式输出课程大纲：

{
  "course_title": "课程标题（要有吸引力，包含主题）",
  "grade": "年级",
  "subject": "学科",
  "total_modules": 模块总数,
  "estimated_hours": 预计总课时,
  "modules": [
    {
      "module_id": "M001",
      "title": "模块标题（简洁、吸引人）",
      "description": "模块描述（30-50字，说明这个模块要学什么）",
      "sequence": 1,
      "duration_minutes": 80,
      "learning_objectives": [
        "学习目标1（要具体，以学生为主语，如：能够...）",
        "学习目标2（要可衡量）",
        "学习目标3（包含知识、能力、情感目标）"
      ],
      "key_concepts": [
        "关键概念1",
        "关键概念2",
        "关键概念3"
      ],
      "prerequisites": []
    }
  ]
}

【重要提示】
1. 必须输出完整的、格式正确的 JSON
2. 不要输出任何 JSON 之外的文字说明
3. 模块数量控制在 3-5 个
4. 每个模块的学习目标要 3-5 个
5. 关键概念固定 3 个
6. course_title 要包含年级、学科和主题
7. 模块之间要有逻辑顺序（由易到难，由浅入深）
8. 学习目标要符合小学生水平

现在请开始生成课程大纲：
```

**变量引用说明：**
- `{TEXTBOOK_CONTENT}` - 引用输入节点的 TEXTBOOK_CONTENT 参数
- `{GRADE_LEVEL}` - 引用输入节点的 GRADE_LEVEL 参数
- `{SUBJECT}` - 引用输入节点的 SUBJECT 参数
- `{MODULE_COUNT}` - 引用输入节点的 MODULE_COUNT 参数

**在界面上如何引用变量：**
```
1. 在 Prompt 编辑框中输入 {
2. 会弹出变量选择列表
3. 选择对应的输入参数
4. 或者直接输入 {参数名}
```

---

### 步骤4：添加 JSON 解析节点（可选但推荐）

有些平台支持 JSON 解析节点，可以验证输出格式：

**节点名称：** `JSON格式验证`

**配置：**
- 输入：大模型节点的输出
- 验证规则：检查是否为有效 JSON
- 如果解析失败：提示错误或重试

**如果平台不支持 JSON 节点：**
- 跳过这一步
- 直接在输出节点接收大模型的文本输出
- 后端程序中进行 JSON 解析

---

### 步骤5：配置输出节点

**输出节点配置：**

| 输出参数名 | 来源 | 说明 |
|-----------|------|------|
| course_outline | 大模型节点的输出 | 完整的课程大纲 JSON |
| raw_response | 大模型节点的原始输出 | 用于调试 |

**在界面上的操作：**
```
1. 拖拽"输出"节点到画布
2. 连接大模型节点到输出节点
3. 在输出节点配置：
   - 添加输出字段
   - 映射到大模型的输出
```

---

### 步骤6：节点连接

**连接顺序：**
```
[输入节点] 
    ↓
[大模型节点] 
    ↓
[输出节点]
```

**在画布上连接：**
1. 点击输入节点的输出端口
2. 拖动到大模型节点的输入端口
3. 点击大模型节点的输出端口
4. 拖动到输出节点的输入端口

---

## 🧪 测试工作流

### 测试数据

使用之前创建的 `sample_textbook_simple.md` 内容：

**输入参数：**

```json
{
  "TEXTBOOK_CONTENT": "# 小学语文三年级 - 春天主题单元（测试版）\n\n## 第1课 春天来了\n\n春天来了，春天来了！\n\n小草从地下探出头来，那是春天的眉毛吧？\n\n早开的野花一朵两朵，那是春天的眼睛吧？\n\n树木吐出点点嫩芽，那是春天的音符吧？\n\n解冻的小溪叮叮咚咚，那是春天的琴声吧？\n\n春天来了！我们看到了她，我们听到了她，我们闻到了她，我们触到了她。她在柳枝上荡秋千，在风筝尾巴上摇啊摇；她在喜鹊、杜鹃嘴里叫，在桃花、杏花枝头笑。\n\n**学习目标：**\n1. 能够说出春天的主要特征\n2. 理解并运用拟人修辞手法\n3. 培养观察自然的兴趣\n\n**重点词语：**\n探出、嫩芽、音符、叮咚、荡秋千、杜鹃\n\n---\n\n## 第2课 美丽的荷花\n\n清早，我到公园去玩，一进门就闻到一阵清香。我赶紧往荷花池边跑去。\n\n荷花已经开了不少了。荷叶挨挨挤挤的，像一个个碧绿的大圆盘。白荷花在这些大圆盘之间冒出来。\n\n有的才展开两三片花瓣儿。有的花瓣儿全展开了，露出嫩黄色的小莲蓬。有的还是花骨朵儿，看起来饱胀得马上要破裂似的。\n\n这么多的白荷花，一朵有一朵的姿势。看看这一朵，很美；看看那一朵，也很美。\n\n我忽然觉得自己仿佛就是一朵荷花，穿着雪白的衣裳，站在阳光里。一阵微风吹来，我就翩翩起舞，雪白的衣裳随风飘动。\n\n**学习目标：**\n1. 学会观察和描写植物的不同姿态\n2. 体会作者的想象和情感\n3. 学习使用比喻句\n\n**重点词语：**\n挨挨挤挤、花骨朵儿、饱胀、翩翩起舞",
  "GRADE_LEVEL": "三年级",
  "SUBJECT": "语文",
  "MODULE_COUNT": 3
}
```

**简化的测试输入（直接复制到测试界面）：**

```
TEXTBOOK_CONTENT:
第1课 春天来了
春天来了，春天来了！
小草从地下探出头来，那是春天的眉毛吧？
早开的野花一朵两朵，那是春天的眼睛吧？
树木吐出点点嫩芽，那是春天的音符吧？
春天来了！我们看到了她，我们听到了她，我们闻到了她，我们触到了她。

第2课 美丽的荷花
荷花已经开了不少了。荷叶挨挨挤挤的，像一个个碧绿的大圆盘。
有的才展开两三片花瓣儿。有的花瓣儿全展开了，露出嫩黄色的小莲蓬。
我忽然觉得自己仿佛就是一朵荷花，穿着雪白的衣裳，站在阳光里。

第3课 勤劳的小蜜蜂
听说蜜蜂有辨认方向的能力，无论飞到哪里，它总是可以回到原处。
尽管它们逆风而飞，沿途都是陌生的景物，但它们确确实实飞回来了。
蜜蜂靠的不是超常的记忆力，而是一种我无法解释的本能。

GRADE_LEVEL: 三年级
SUBJECT: 语文
MODULE_COUNT: 3
```

### 执行测试

1. **点击"测试运行"按钮**
2. **填入测试数据**
3. **查看运行日志**
4. **检查输出结果**

### 预期输出示例

```json
{
  "course_outline": {
    "course_title": "三年级语文《走进春天》主题课程",
    "grade": "三年级",
    "subject": "语文",
    "total_modules": 3,
    "estimated_hours": 4,
    "modules": [
      {
        "module_id": "M001",
        "title": "感受春天",
        "description": "通过课文学习，运用多种感官感受春天的美好，学习拟人修辞手法",
        "sequence": 1,
        "duration_minutes": 80,
        "learning_objectives": [
          "能够用五官描述春天的特征",
          "理解并运用拟人修辞手法描写景物",
          "培养观察自然、热爱自然的情感"
        ],
        "key_concepts": [
          "五感描写",
          "拟人修辞",
          "季节特征"
        ],
        "prerequisites": []
      },
      {
        "module_id": "M002",
        "title": "观察植物",
        "description": "学习细致观察植物的方法，用比喻和想象描写植物的美",
        "sequence": 2,
        "duration_minutes": 80,
        "learning_objectives": [
          "能够观察并描述植物的不同形态",
          "学会运用比喻句增强描写的生动性",
          "培养丰富的想象力和审美情趣"
        ],
        "key_concepts": [
          "观察方法",
          "比喻修辞",
          "想象描写"
        ],
        "prerequisites": ["M001"]
      },
      {
        "module_id": "M003",
        "title": "探索自然",
        "description": "了解动物的特殊本能，学习科学观察和思考的方法",
        "sequence": 3,
        "duration_minutes": 80,
        "learning_objectives": [
          "认识动物的特殊本能和生存智慧",
          "了解科学观察和实验的基本方法",
          "培养探索自然奥秘的兴趣和精神"
        ],
        "key_concepts": [
          "动物本能",
          "科学观察",
          "实验方法"
        ],
        "prerequisites": ["M001", "M002"]
      }
    ]
  }
}
```

---

## ✅ 测试检查清单

### 输出质量检查

- [ ] **JSON 格式正确**
  - 能够被解析
  - 没有语法错误
  - 字段完整

- [ ] **内容质量**
  - [ ] 模块数量正确（3个）
  - [ ] 标题简洁有吸引力
  - [ ] 描述清晰（30-50字）
  - [ ] 学习目标具体可行（3-5个）
  - [ ] 关键概念准确（3个）
  - [ ] 模块顺序合理

- [ ] **适配性**
  - [ ] 适合小学三年级水平
  - [ ] 基于课本内容
  - [ ] 没有偏离主题

### 如果测试失败

**常见问题及解决方案：**

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 输出不是 JSON | Prompt 不够明确 | 强调"只输出 JSON，不要其他文字" |
| JSON 格式错误 | 模型理解有误 | 在 Prompt 中提供更详细的 JSON 示例 |
| 模块数量不对 | 没有遵循要求 | 在 Prompt 中强调"必须生成 {MODULE_COUNT} 个模块" |
| 内容质量差 | Temperature 太高或太低 | 调整 Temperature 为 0.7 |
| 学习目标不具体 | 指令不够清晰 | 增加示例："能够...""学会...""掌握..." |
| 超时 | 输入内容太长 | 减少测试内容或增加超时时间 |

---

## 🔄 Prompt 优化技巧

### 技巧1：提供具体示例

在 System Prompt 中加入：

```
示例输出：
{
  "module_id": "M001",
  "title": "认识春天",
  "description": "通过阅读课文，运用多种感官感受春天的美好",
  "learning_objectives": [
    "能够说出春天的3-5个主要特征",
    "理解课文中运用拟人手法的句子",
    "培养观察自然的兴趣和习惯"
  ],
  "key_concepts": [
    "季节更替",
    "拟人修辞",
    "感官描写"
  ]
}
```

### 技巧2：使用约束性指令

```
【严格要求】
- 模块标题不超过 10 个字
- 模块描述必须在 30-50 字之间
- 每个学习目标以"能够""学会""掌握"开头
- 关键概念必须是名词或名词短语
```

### 技巧3：分步骤引导

```
请按以下步骤完成：

步骤1：分析课本内容，识别主要主题和知识点
步骤2：将内容划分为 {MODULE_COUNT} 个逻辑模块
步骤3：为每个模块设计学习目标（3-5个）
步骤4：提炼每个模块的 3 个关键概念
步骤5：按照 JSON 格式组织输出

现在开始执行：
```

### 技巧4：增加格式验证

```
输出前请自检：
✓ JSON 格式是否正确
✓ 所有必填字段是否存在
✓ 模块数量是否为 {MODULE_COUNT}
✓ 每个模块是否有 3 个关键概念
✓ 学习目标是否具体可衡量

自检通过后，输出 JSON：
```

---

## 📝 发布工作流

### 测试通过后

1. **点击"保存"**
2. **点击"发布"**
3. **记录工作流 ID**
   - 在工作流详情页找到
   - 格式类似：`7388113512793067522`
   - 后续 API 调用需要用到

### 获取 API 调用信息

**在工作流详情页：**
1. 点击"API 调用"或"使用说明"
2. 查看 API 端点
3. 获取调用示例
4. 记录必要的参数

**典型的 API 信息：**
```
端点：http://{本地 IP 地址}/workflow/v1/chat/completions
方法：POST
认证：Bearer {API_KEY}:{API_SECRET}
```

---

## 🎯 下一步行动

### 完成后

✅ 你将拥有：
- 一个可工作的课程大纲生成器
- 清楚如何调用 API
- 可以继续后端开发

✅ 接下来可以：
- 在后端集成这个工作流
- 开发前端界面
- 测试完整流程

---

## 📞 需要帮助？

### 遇到问题时

1. **查看运行日志**
   - 工作流测试页面有详细日志
   - 查看每个节点的输入输出

2. **调整 Prompt**
   - 根据输出结果优化提示词
   - 多次测试找到最佳配置

3. **参考文档**
   - 讯飞星辰官方文档
   - 社区案例和教程

### 把结果告诉我

完成后，请分享：
1. 工作流是否创建成功
2. 测试输出的效果如何
3. 遇到了什么问题
4. 工作流 ID（用于后续开发）

---

**准备好了就开始创建吧！🚀**

记住：第一次可能不完美，多测试、多调整，逐步优化！
