# AI 课程生成系统 - 开发文档

## 📋 文档说明

**目标读者：** Claude Code

**目的：** 提供清晰的开发指引，无需详细代码，只需核心架构和要点

**开发周期：** 2-3 天完成 MVP

---

## 🎯 项目概述

### 产品定位
一个基于 AI 的小学课程生成工具，教师输入课本文本内容，系统自动生成结构化的课程大纲和详细教学内容。

### 核心功能流程

```
用户在前端输入课本文本
    ↓
后端调用【工作流1】
    ↓
返回课程大纲（4个模块）
    ↓
前端展示大纲卡片
    ↓
用户点击某个模块"查看详情"
    ↓
后端调用【工作流2】
    ↓
返回该模块的详细教学内容
    ↓
前端展示详细内容
```

---

## 🏗️ 技术架构

### 整体架构

```
┌─────────────────────────────────────────┐
│           前端 (React)                   │
│  ┌──────────┐  ┌──────────┐            │
│  │文本输入页 │  │课程展示页 │            │
│  └──────────┘  └──────────┘            │
└────────────────┬────────────────────────┘
                 │ REST API
                 ↓
┌─────────────────────────────────────────┐
│         后端 (FastAPI)                   │
│  ┌──────────┐  ┌──────────┐            │
│  │生成大纲API│  │生成详情API│            │
│  └──────────┘  └──────────┘            │
└────────────────┬────────────────────────┘
                 │ HTTP 调用
                 ↓
┌─────────────────────────────────────────┐
│       讯飞星辰工作流 API                  │
│  ┌──────────────┐  ┌──────────────┐   │
│  │  工作流1      │  │  工作流2      │   │
│  │CourseOutline  │  │ModuleContent  │   │
│  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────┘
```

### 技术栈

**前端：**
- React 18.x
- TypeScript
- Ant Design 5.x
- Axios
- React Router（如果需要多页面）

**后端：**
- Python 3.10+
- FastAPI
- httpx（异步 HTTP 客户端）
- Pydantic（数据验证）

**部署：**
- 前端：Vercel / Netlify
- 后端：云服务器 / Docker

---

## 📂 项目结构

```
ai-course-generator/
├── frontend/                 # 前端项目
│   ├── src/
│   │   ├── components/       # 组件
│   │   │   ├── TextInput.tsx      # 文本输入组件
│   │   │   ├── CourseOutline.tsx  # 大纲展示组件
│   │   │   ├── ModuleDetail.tsx   # 详情展示组件
│   │   │   └── Loading.tsx        # 加载组件
│   │   ├── services/         # API 服务
│   │   │   └── api.ts        # API 调用封装
│   │   ├── types/            # 类型定义
│   │   │   └── course.ts     # 课程数据类型
│   │   ├── App.tsx           # 主应用
│   │   └── index.tsx         # 入口文件
│   ├── package.json
│   └── tsconfig.json
│
├── backend/                  # 后端项目
│   ├── main.py               # FastAPI 主文件
│   ├── models.py             # 数据模型
│   ├── config.py             # 配置文件
│   ├── workflow_client.py    # 工作流调用客户端
│   ├── requirements.txt      # 依赖
│   └── .env                  # 环境变量（不提交到 Git）
│
├── docs/                     # 文档
│   ├── API.md                # API 文档
│   └── DEPLOYMENT.md         # 部署文档
│
└── README.md                 # 项目说明
```

---

## 🔌 API 接口设计

### 后端 API

#### 1. 生成课程大纲

**端点：** `POST /api/generate-outline`

**请求体：**
```json
{
  "textbook_content": "课本文本内容",
  "grade_level": "三年级",
  "subject": "语文",
  "module_count": 4
}
```

**响应：**
```json
{
  "success": true,
  "data": {
    "course_title": "课程标题",
    "grade": "三年级",
    "subject": "语文",
    "total_modules": 4,
    "modules": [
      {
        "module_id": "M001",
        "title": "模块标题",
        "description": "模块描述",
        "learning_objectives": ["目标1", "目标2"],
        "key_concepts": ["概念1", "概念2", "概念3"]
      }
    ]
  }
}
```

**错误响应：**
```json
{
  "success": false,
  "error": "错误信息"
}
```

---

#### 2. 生成模块详细内容

**端点：** `POST /api/generate-detail`

**请求体：**
```json
{
  "module_info": {
    "module_id": "M001",
    "title": "模块标题",
    "description": "模块描述",
    "learning_objectives": ["目标1"],
    "key_concepts": ["概念1"]
  },
  "textbook_content": "相关课文内容",
  "detail_level": "standard",
  "exercise_count": 5
}
```

**响应：**
```json
{
  "success": true,
  "data": {
    "module_id": "M001",
    "teaching_plan": {
      "introduction": {...},
      "main_content": {...},
      "practice": {...},
      "summary": {...}
    },
    "examples": [...],
    "exercises": [...],
    "teaching_tips": [...]
  }
}
```

---

#### 3. 健康检查（可选）

**端点：** `GET /health`

**响应：**
```json
{
  "status": "ok",
  "version": "1.0.0"
}
```

---

## 🔧 后端核心实现要点

### 配置管理

**环境变量（.env 文件）：**
```
# 讯飞星辰 API 配置
XINGCHEN_API_URL=http://{本地 IP 地址}/workflow/v1/chat/completions
XINGCHEN_API_KEY=your_api_key
XINGCHEN_API_SECRET=your_api_secret

# 工作流 ID
WORKFLOW_1_ID=课程大纲生成器的ID
WORKFLOW_2_ID=模块详细内容生成器的ID

# 服务配置
BACKEND_PORT=8000
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
```

**注意：**
- `.env` 文件不要提交到 Git
- 提供 `.env.example` 作为模板

---

### 工作流调用

**关键点：**

1. **认证方式**
   - 使用 `Bearer {API_KEY}:{API_SECRET}` 格式
   - 放在 `Authorization` 请求头中

2. **请求格式**
   ```
   端点：POST http://{本地 IP 地址}/workflow/v1/chat/completions
   
   Headers:
     Content-Type: application/json
     Authorization: Bearer {API_KEY}:{API_SECRET}
   
   Body:
     {
       "flow_id": "工作流ID",
       "uid": "user_123",
       "parameters": {
         "参数名": "参数值"
       },
       "stream": false
     }
   ```

3. **响应处理**
   - 成功：状态码 200，响应体包含 JSON
   - 失败：处理错误信息，返回友好提示

4. **超时设置**
   - 大纲生成：60 秒
   - 详情生成：120 秒（内容更多）

5. **错误处理**
   - 网络超时 → "生成时间过长，请重试"
   - API 错误 → 显示具体错误信息
   - JSON 解析失败 → "AI 返回格式错误，请重试"

---

### CORS 配置

**要点：**
- 允许前端域名跨域访问
- 开发环境：`http://localhost:3000` 或 `http://localhost:5173`
- 生产环境：实际部署的前端域名

---

### 数据验证

**使用 Pydantic 定义数据模型：**
- 验证输入参数的格式
- 自动生成 API 文档
- 类型安全

**需要定义的模型：**
- `GenerateOutlineRequest` - 生成大纲请求
- `GenerateDetailRequest` - 生成详情请求
- `CourseOutline` - 课程大纲
- `ModuleDetail` - 模块详情

---

## 🎨 前端核心实现要点

### 页面结构

#### 主页面（单页应用）

**布局：**
```
┌──────────────────────────────────────┐
│          顶部导航栏                   │
├──────────────────────────────────────┤
│                                      │
│  [文本输入区]（初始状态）              │
│                                      │
│        或                            │
│                                      │
│  [课程大纲展示区]（生成后）            │
│                                      │
│        或                            │
│                                      │
│  [模块详情展示区]（点击模块后）        │
│                                      │
└──────────────────────────────────────┘
```

**状态管理：**
- 当前视图状态：输入 / 大纲 / 详情
- 课程大纲数据
- 当前选中的模块
- 加载状态

---

### 组件设计

#### 1. TextInput 组件

**功能：**
- 显示文本输入框（多行）
- 可选参数：年级、学科、模块数量
- "生成课程大纲"按钮
- 加载状态显示

**交互：**
```
用户输入文本
    ↓
点击"生成课程大纲"
    ↓
显示加载动画
    ↓
调用 API
    ↓
成功 → 切换到大纲展示
失败 → 显示错误提示
```

**UI 要点：**
- 文本框至少 10 行高
- 字数统计提示
- 输入验证（不能为空，最少 100 字）
- 清晰的错误提示

---

#### 2. CourseOutline 组件

**功能：**
- 展示课程标题和基本信息
- 卡片式展示所有模块
- 每个模块显示：
  - 标题
  - 描述
  - 学习目标（可折叠）
  - 关键概念标签
  - "查看详情"按钮

**交互：**
```
点击"查看详情"
    ↓
显示加载动画
    ↓
调用详情 API
    ↓
切换到详情展示
```

**UI 要点：**
- 使用 Ant Design 的 Card 组件
- 模块卡片要有悬停效果
- 学习目标默认折叠（点击展开）
- 关键概念用 Tag 组件展示
- 返回按钮（回到输入页重新生成）

---

#### 3. ModuleDetail 组件

**功能：**
- 展示单个模块的详细内容
- 分区展示：
  - 教学计划（4个环节）
  - 教学案例
  - 练习题（答案可折叠）
  - 教学建议

**交互：**
```
点击"返回大纲"
    ↓
返回到大纲展示页
```

**UI 要点：**
- 使用 Collapse 组件展示可折叠内容
- 练习题的答案默认隐藏
- 教学计划用时间轴展示（Ant Design Timeline）
- 清晰的章节标题
- 支持复制内容

---

#### 4. Loading 组件

**功能：**
- 显示加载状态
- 显示进度提示文字

**UI 样式：**
```
┌──────────────────────────┐
│                          │
│       ⏳ 加载中...        │
│                          │
│   正在生成课程大纲...     │
│                          │
│   预计需要 30 秒          │
│                          │
└──────────────────────────┘
```

---

### API 调用封装

**services/api.ts 要点：**

1. **基础配置**
   - 设置 baseURL
   - 设置超时时间
   - 添加请求拦截器（可选）
   - 添加响应拦截器（统一错误处理）

2. **封装两个函数**
   - `generateOutline(params)` - 生成大纲
   - `generateDetail(params)` - 生成详情

3. **错误处理**
   - 网络错误
   - 超时错误
   - API 返回错误
   - 统一的错误提示

---

### TypeScript 类型定义

**types/course.ts 要点：**

定义以下类型：
- `CourseModule` - 单个模块
- `CourseOutline` - 完整大纲
- `TeachingPlan` - 教学计划
- `Exercise` - 练习题
- `ModuleDetail` - 模块详情

**好处：**
- 类型安全
- IDE 自动补全
- 减少错误

---

## 🎯 核心功能实现流程

### 流程1：生成课程大纲

```
1. 用户在文本框输入课本内容
   - 最少 100 字
   - 提供默认测试文本（可选）

2. 用户选择可选参数
   - 年级（默认：三年级）
   - 学科（默认：语文）
   - 模块数量（默认：4）

3. 点击"生成课程大纲"
   - 前端验证输入
   - 显示加载状态

4. 前端调用后端 API
   POST /api/generate-outline
   {
     "textbook_content": "...",
     "grade_level": "三年级",
     "subject": "语文",
     "module_count": 4
   }

5. 后端调用工作流1
   - 构建请求参数
   - 调用讯飞星辰 API
   - 解析响应 JSON

6. 后端返回结果
   - 成功：返回大纲数据
   - 失败：返回错误信息

7. 前端处理响应
   - 成功：保存数据，切换到大纲展示
   - 失败：显示错误消息

8. 展示课程大纲
   - 卡片式布局
   - 4 个模块卡片
```

---

### 流程2：查看模块详情

```
1. 用户点击某个模块的"查看详情"
   - 获取该模块的完整信息

2. 显示加载状态
   - "正在生成详细内容..."

3. 前端调用后端 API
   POST /api/generate-detail
   {
     "module_info": {...},
     "textbook_content": "...",
     "detail_level": "standard",
     "exercise_count": 5
   }

4. 后端调用工作流2
   - 构建请求参数
   - 调用讯飞星辰 API
   - 解析响应 JSON

5. 后端返回结果
   - 成功：返回详细内容
   - 失败：返回错误信息

6. 前端处理响应
   - 成功：切换到详情展示
   - 失败：显示错误，停留在大纲页

7. 展示详细内容
   - 教学计划
   - 案例
   - 练习题
   - 建议
```

---

## 🔐 安全注意事项

### 1. API 密钥保护
- ⚠️ **绝对不要**在前端代码中暴露 API Key 和 Secret
- ✅ 所有 AI 调用必须通过后端进行
- ✅ 使用环境变量存储敏感信息
- ✅ `.env` 文件不要提交到 Git

### 2. 输入验证
- 前端：基础验证（长度、格式）
- 后端：严格验证（防止注入攻击）

### 3. 速率限制
- 考虑添加请求频率限制
- 防止 API 被滥用

### 4. CORS 配置
- 只允许信任的域名访问
- 生产环境使用白名单

---

## 📊 数据流示例

### 完整的数据流

```json
// 1. 用户输入
{
  "textbook_content": "第1课 春天来了\n\n春天来了，春天来了！...",
  "grade_level": "三年级",
  "subject": "语文",
  "module_count": 4
}

// 2. 后端调用工作流1，讯飞返回
{
  "output": "{\"course_title\":\"...\",\"modules\":[...]}"
}

// 3. 后端解析并返回给前端
{
  "success": true,
  "data": {
    "course_title": "三年级语文·春天主题单元",
    "grade": "三年级",
    "subject": "语文",
    "total_modules": 4,
    "modules": [
      {
        "module_id": "M001",
        "title": "春天的脚步",
        "description": "...",
        "learning_objectives": [...],
        "key_concepts": [...]
      }
    ]
  }
}

// 4. 前端展示大纲

// 5. 用户点击模块1的"查看详情"

// 6. 后端调用工作流2，讯飞返回详细内容

// 7. 前端展示详细内容
```

---

## 🧪 测试要点

### 后端测试

1. **API 端点测试**
   - 使用 Postman 或 curl 测试
   - 测试正常情况和异常情况

2. **工作流调用测试**
   - 单独测试工作流调用
   - 验证参数传递正确
   - 验证响应解析正确

3. **错误处理测试**
   - 网络错误
   - 超时
   - API 返回错误

### 前端测试

1. **组件渲染测试**
   - 各个组件正常渲染
   - 加载状态显示正确

2. **交互测试**
   - 按钮点击
   - 表单提交
   - 页面切换

3. **API 集成测试**
   - 调用成功的情况
   - 调用失败的情况
   - 加载状态

### 端到端测试

使用真实的课本内容测试完整流程：
1. 输入文本
2. 生成大纲
3. 查看详情
4. 返回大纲
5. 查看另一个模块

---

## 📦 部署指南要点

### 后端部署

**选项1：直接部署**
1. 安装 Python 依赖
2. 配置环境变量
3. 运行 `uvicorn main:app --host 0.0.0.0 --port 8000`

**选项2：Docker 部署**
1. 编写 Dockerfile
2. 构建镜像
3. 运行容器

**注意：**
- 设置正确的 CORS 源
- 使用 HTTPS（生产环境）
- 配置反向代理（Nginx）

### 前端部署

**选项1：Vercel（推荐）**
1. 连接 Git 仓库
2. 自动构建和部署
3. 配置环境变量（API 地址）

**选项2：Netlify**
1. 连接 Git 仓库
2. 配置构建命令
3. 自动部署

**注意：**
- 配置正确的 API baseURL
- 使用环境变量管理不同环境的配置

---

## 🎯 开发优先级

### 第一阶段：核心功能（1-2天）

**后端：**
1. ✅ 搭建 FastAPI 框架
2. ✅ 实现工作流调用客户端
3. ✅ 实现两个 API 端点
4. ✅ 错误处理

**前端：**
1. ✅ 搭建 React 项目
2. ✅ 实现文本输入组件
3. ✅ 实现大纲展示组件
4. ✅ 实现 API 调用

### 第二阶段：详情功能（1天）

**前端：**
1. ✅ 实现详情展示组件
2. ✅ 完善 UI 和交互
3. ✅ 响应式适配

### 第三阶段：优化和部署（0.5-1天）

1. ✅ 错误处理优化
2. ✅ 加载状态优化
3. ✅ UI 美化
4. ✅ 部署上线

---

## 📝 开发检查清单

### 后端

- [ ] FastAPI 项目初始化
- [ ] 环境变量配置
- [ ] 工作流调用函数实现
- [ ] `/api/generate-outline` 端点
- [ ] `/api/generate-detail` 端点
- [ ] CORS 配置
- [ ] 错误处理
- [ ] API 文档生成
- [ ] 本地测试通过

### 前端

- [ ] React 项目初始化
- [ ] TypeScript 配置
- [ ] Ant Design 集成
- [ ] TextInput 组件
- [ ] CourseOutline 组件
- [ ] ModuleDetail 组件
- [ ] Loading 组件
- [ ] API 服务封装
- [ ] 状态管理
- [ ] 响应式布局
- [ ] 错误处理
- [ ] 本地测试通过

### 联调

- [ ] 前后端联调
- [ ] 端到端流程测试
- [ ] 各种异常情况测试
- [ ] 性能测试

### 部署

- [ ] 后端部署
- [ ] 前端部署
- [ ] 环境变量配置
- [ ] 生产环境测试

---

## 💡 开发建议

### 1. 开发顺序

**推荐顺序：**
```
后端基础框架
    ↓
工作流1调用（大纲生成）
    ↓
前端文本输入 + 大纲展示
    ↓
联调测试
    ↓
工作流2调用（详情生成）
    ↓
前端详情展示
    ↓
完整测试
    ↓
部署
```

### 2. 调试技巧

- 先用 Postman 测试后端 API
- 使用浏览器控制台查看网络请求
- 在后端添加详细的日志
- 使用 console.log 调试前端

### 3. 代码组织

- 保持代码模块化
- 函数单一职责
- 添加必要的注释
- 统一的代码风格

---

## 🚀 开始开发

### 准备工作

1. **获取必要信息**
   - ✅ 讯飞星辰 API Key 和 Secret
   - ✅ 工作流1的 ID
   - ✅ 工作流2的 ID（测试完成后）

2. **创建项目结构**
   - 创建 `frontend` 和 `backend` 目录
   - 初始化 Git 仓库

3. **参考测试数据**
   - 使用提供的测试课本内容
   - 使用工作流1的实际输出作为测试数据

### 开发步骤

1. **后端优先**
   - 先实现工作流调用
   - 先实现大纲生成 API
   - 用 Postman 测试通过

2. **前端跟进**
   - 实现输入和展示
   - 对接后端 API
   - 完成基础流程

3. **迭代优化**
   - 添加详情功能
   - 优化 UI/UX
   - 完善错误处理

---

## 📚 参考资料

### API 文档
- FastAPI 官方文档：https://fastapi.tiangolo.com/
- React 官方文档：https://react.dev/
- Ant Design 文档：https://ant.design/

### 工作流信息
- 工作流1配置文档：WORKFLOW_SETUP_GUIDE.md
- 工作流2配置文档：WORKFLOW2_SETUP_GUIDE.md
- 测试数据：sample_textbook_simple.md

### 产品需求
- 完整 PRD：AI_COURSE_GENERATOR_PRD.md

---

## ❓ 常见问题

### Q1: 如何处理 AI 返回的 JSON 格式错误？
**A:** 在后端添加 JSON 验证和清理逻辑，如果解析失败，返回友好的错误提示。

### Q2: 如何处理超时？
**A:** 设置合理的超时时间（60-120秒），超时后提示用户重试。

### Q3: 前端如何保存大纲数据？
**A:** 使用 React State 或 Context API，页面刷新会丢失，如需持久化可使用 localStorage。

### Q4: 是否需要用户登录？
**A:** MVP 阶段不需要，后续版本可以添加。

### Q5: 如何调试工作流调用？
**A:** 在后端打印完整的请求和响应，检查参数是否正确传递。

---

## ✅ 交付标准

### 代码交付
- [ ] 完整的前端代码
- [ ] 完整的后端代码
- [ ] README.md（如何运行）
- [ ] requirements.txt 和 package.json
- [ ] .env.example（环境变量模板）

### 功能交付
- [ ] 能够输入文本生成大纲
- [ ] 能够查看模块详情
- [ ] 错误处理完善
- [ ] UI 美观易用

### 文档交付
- [ ] API 接口文档
- [ ] 部署说明
- [ ] 使用说明

---

## 🎉 最后的话

这个项目架构清晰，功能明确，开发起来应该很顺利。

**核心要点：**
1. 后端负责所有 AI 调用，保护 API 密钥
2. 前端专注于展示和交互
3. 数据流清晰：文本 → 大纲 → 详情
4. 错误处理要完善

**开发建议：**
- 先实现核心流程，再完善细节
- 多测试，特别是异常情况
- 保持代码简洁，易于维护

祝开发顺利！🚀

如有问题，随时沟通！
